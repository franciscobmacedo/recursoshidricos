(function(e){function t(t){for(var n,i,o=t[0],c=t[1],l=t[2],u=0,m=[];u<o.length;u++)i=o[u],Object.prototype.hasOwnProperty.call(r,i)&&r[i]&&m.push(r[i][0]),r[i]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(e[n]=c[n]);d&&d(t);while(m.length)m.shift()();return s.push.apply(s,l||[]),a()}function a(){for(var e,t=0;t<s.length;t++){for(var a=s[t],n=!0,o=1;o<a.length;o++){var c=a[o];0!==r[c]&&(n=!1)}n&&(s.splice(t--,1),e=i(i.s=a[0]))}return e}var n={},r={app:0},s=[];function i(t){if(n[t])return n[t].exports;var a=n[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=e,i.c=n,i.d=function(e,t,a){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(a,n,function(t){return e[t]}.bind(null,n));return a},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=t,o=o.slice();for(var l=0;l<o.length;l++)t(o[l]);var d=c;s.push([0,"chunk-vendors"]),a()})({0:function(e,t,a){e.exports=a("56d7")},5490:function(e,t,a){"use strict";a("a6b6")},"56d7":function(e,t,a){"use strict";a.r(t);a("e260"),a("e6cf"),a("cca6"),a("a79d");var n=a("2b0e"),r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-app",[a("v-app-bar",{attrs:{app:"",color:"white",dense:""}},[a("div",{staticClass:"d-flex align-center"},[e._v("Recursos Hídricos")]),a("v-spacer"),a("v-btn",{attrs:{href:"https://snirh.apambiente.pt/",target:"_blank",text:""}},[a("span",{staticClass:"mr-2"},[e._v("Dados recolhidos no stie original")]),a("v-icon",[e._v("mdi-open-in-new")])],1)],1),a("v-main",[a("v-container",{attrs:{fluid:""}},[a("v-row",[a("v-col",{attrs:{sm:"12",md:"3"}},[a("v-autocomplete",{attrs:{loading:e.loadingNetworks,items:e.networks,"item-text":"nome","return-object":"",placeholder:"Rede",label:"Rede"},on:{change:e.getNetworkStations},model:{value:e.network,callback:function(t){e.network=t},expression:"network"}}),a("Map")],1),a("v-col",[a("v-row",[a("v-col",{attrs:{sm:"12",md:"8"}},[a("Table",{directives:[{name:"show",rawName:"v-show",value:e.network,expression:"network"}],attrs:{headers:e.stationsHeaders,items:e.stations,selectedItems:e.selectedStations,loadingItems:e.loadingStations,searchPlaceholder:"Procurar estações",onlySelectedLable:"Mostrar só selecionadas",selectedHelperText:"estações selecionadas",expandableFields:e.expandableFields},on:{selectItems:e.setSelectedStations,clearSelection:e.setSelectedStations}})],1),a("v-divider",{directives:[{name:"show",rawName:"v-show",value:e.network,expression:"network"}],attrs:{vertical:""}}),a("v-col",{attrs:{sm:"12",md:"4"}},[a("Table",{directives:[{name:"show",rawName:"v-show",value:e.network,expression:"network"}],attrs:{headers:e.parametersHeaders,items:e.parameters,selectedItems:e.selectedParameters,loadingItems:e.loadingParameters,selectedHelperText:"parâmetros selecionados",searchPlaceholder:"Procurar parâmetros"},on:{selectItems:e.setSelectedParameters,clearSelection:e.setSelectedParameters}})],1)],1),a("v-row",{directives:[{name:"show",rawName:"v-show",value:e.network,expression:"network"}],attrs:{align:"center",justify:"center"}},[a("v-col",{attrs:{md:"2"}},[a("v-chip",{attrs:{color:"green lighten-1",dark:""}},[e._v(" "+e._s(e.selectedStations.length)+" estações selecionadas ")])],1),a("v-col",{attrs:{md:"2"}},[a("v-chip",{attrs:{color:"blue lighten-1",dark:""}},[e._v(" "+e._s(e.selectedParameters.length)+" parametros selecionados ")])],1),a("v-col",{attrs:{md:"2"}},[a("DatePicker",{attrs:{name:"Data de início",dateProps:e.startDate},on:{setDate:e.setStartDate}})],1),a("v-col",{attrs:{md:"2"}},[a("DatePicker",{attrs:{name:"Data de fim",dateProps:e.endDate,minDate:e.startDate},on:{setDate:e.setEndDate}})],1),a("v-col",{attrs:{md:"2"}},[a("v-btn",{attrs:{color:"primary",disabled:e.loadingData},on:{click:function(t){return e.getData()}}},[a("v-icon",[e._v("mdi-download")]),e._v(" Transferir dados ")],1)],1)],1)],1)],1)],1)],1)],1)},s=[],i=a("5530"),o=a("1da1"),c=(a("d81d"),a("caad"),a("2532"),a("99af"),a("4d90"),a("96cf"),a("2f62")),l=a("bc3a"),d=a.n(l),u=Object({NODE_ENV:"production",BASE_URL:"/"}).VUE_APP_API,m=d.a.create({baseURL:u});function p(){return h.apply(this,arguments)}function h(){return h=Object(o["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("getting networks"),e.next=3,m.get("networks");case 3:return t=e.sent,e.abrupt("return",t.data);case 5:case"end":return e.stop()}}),e)}))),h.apply(this,arguments)}function f(e){return v.apply(this,arguments)}function v(){return v=Object(o["a"])(regeneratorRuntime.mark((function e(t){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("getting stations for network: ",t),e.next=3,m.get("stations",{params:{network_uid:t}});case 3:return a=e.sent,console.log(a.data),e.abrupt("return",a.data);case 6:case"end":return e.stop()}}),e)}))),v.apply(this,arguments)}function g(){return w.apply(this,arguments)}function w(){return w=Object(o["a"])(regeneratorRuntime.mark((function e(){var t,a=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:null,e.next=3,m.get("parameters",{params:{station_uids:t}}).then((function(e){return e.data})).catch((function(e){console.log(e)}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)}))),w.apply(this,arguments)}function b(e,t,a,n){return S.apply(this,arguments)}function S(){return S=Object(o["a"])(regeneratorRuntime.mark((function e(t,a,n,r){var s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,m.get("data",{params:{station_uids:t,parameter_uids:a,tmin:n,tmax:r}});case 2:return s=e.sent,e.abrupt("return",s.data);case 4:case"end":return e.stop()}}),e)}))),S.apply(this,arguments)}var k=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("v-menu",{ref:"menu",attrs:{"close-on-content-click":!1,transition:"scale-transition","offset-y":"","min-width":"auto"},scopedSlots:e._u([{key:"activator",fn:function(t){var n=t.on,r=t.attrs;return[a("v-text-field",e._g(e._b({attrs:{label:e.name,"prepend-icon":"mdi-calendar",readonly:""},model:{value:e.date,callback:function(t){e.date=t},expression:"date"}},"v-text-field",r,!1),n))]}}]),model:{value:e.menu,callback:function(t){e.menu=t},expression:"menu"}},[a("v-date-picker",{attrs:{"active-picker":e.activePicker,max:new Date(Date.now()-6e4*(new Date).getTimezoneOffset()).toISOString().substr(0,10),min:e.minDate},on:{"update:activePicker":function(t){e.activePicker=t},"update:active-picker":function(t){e.activePicker=t},input:function(t){e.menu=!1}},model:{value:e.date,callback:function(t){e.date=t},expression:"date"}})],1)],1)},D=[],x={props:{name:String,dateProps:String,minDate:{type:String,default:"1920-01-01"}},data:function(){return{activePicker:null,menu:!1}},computed:{date:{get:function(){return this.dateProps},set:function(e){this.$emit("setDate",e)}}},watch:{menu:function(e){var t=this;e&&setTimeout((function(){return t.activePicker="YEAR"}))},minDate:function(e){var t=new Date(e),a=new Date(this.date);t>a&&(this.date=e)}}},y=x,_=a("2877"),P=a("6544"),I=a.n(P),O=a("2e4b"),j=a("e449"),M=a("8654"),R=Object(_["a"])(y,k,D,!1,null,null,null),L=R.exports;I()(R,{VDatePicker:O["a"],VMenu:j["a"],VTextField:M["a"]});var V=function(){var e=this,t=e.$createElement;e._self._c;return e._m(0)},T=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"container"}},[a("div",{attrs:{id:"mapContainer"}})])}],A=a("2909"),E=(a("d3b7"),a("159b"),a("4de4"),a("6cc5"),a("5fbf"),a("e11e")),C=a.n(E),N=a("7159"),$=a.n(N),z=(a("20d6"),{name:"Map",data:function(){return{map:null,center:[39.65,-7.85],iconSize:[0,0],iconAnchor:[0,0],markers:[],selectedMarkers:[]}},watch:{stations:function(e){var t=this;console.log("changing stations",e),this.markers.map((function(e){t.map.removeLayer(e)})),this.markers=[],e.forEach((function(e){t.addMarker(e)}))},selectedStationsIDs:function(e){var t=this;this.markers.forEach((function(a){e.includes(a.stationID)?a.setIcon(t.selectedIcon):a.setIcon(t.icon)}))}},computed:Object(i["a"])(Object(i["a"])(Object(i["a"])({},Object(c["c"])(["stations"])),Object(c["b"])(["selectedStationsIDs"])),{},{icon:function(){return C.a.divIcon({className:"custom-div-icon",html:"<div  class='marker-pin'></div>",iconSize:this.iconSize,iconAnchor:this.iconAnchor})},selectedIcon:function(){return C.a.divIcon({className:"custom-div-icon",html:"<div  class='marker-pin selected'></div>",iconSize:this.iconSize,iconAnchor:this.iconAnchor})}}),methods:{setupLeafletMap:function(){this.map=C.a.map("mapContainer",{zoomSnap:.1}).setView(this.center,7.4),C.a.tileLayer("https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}",{maxZoom:18,id:"mapbox/light-v9",accessToken:"pk.eyJ1IjoiZm1hY2VkbzEiLCJhIjoiY2sxODlsdjI1MGdjZjNlbXp1cHVzMmdsMSJ9.XS7XUAnQ6r5fAgzQx0OSmQ"}).addTo(this.map),this.setLeafletDraw()},setLeafletDraw:function(){var e=this,t=new C.a.FeatureGroup,a={draw:{polyline:{shapeOptions:{color:"#f357a1",weight:10}},polygon:{allowIntersection:!1,drawError:{color:"#e1e100",message:"<strong>Oh snap!<strong> you can't draw that!"},shapeOptions:{color:"#bada55"}},rectangle:{shapeOptions:{clickable:!1}}},edit:{featureGroup:t}};this.map.addLayer(t);var n=new C.a.Control.Draw(a);this.map.addControl(n),C.a.Polygon.include({contains:function(e){return $.a.inside(new C.a.Marker(e).toGeoJSON(),this.toGeoJSON())}}),C.a.Circle.include({contains:function(e){return this.getLatLng().distanceTo(e)<this.getRadius()}}),this.map.on(C.a.Draw.Event.CREATED,(function(t){var a=[];e.markers.forEach((function(e){t.layer.contains(e.getLatLng())&&a.push(e.stationID)})),e.$store.commit("setselectedStationsByID",a)}))},addMarker:function(e){var t=C.a.marker([e.latitude,e.longitude],{icon:this.icon,uniqueID:e.uid}).addTo(this.map).on("click",this.clickMarker);t.bindTooltip(e.nome),t.stationID=e.uid,this.markers.push(t)},clickMarker:function(e){var t;t=e.originalEvent.metaKey?this.selectedStationsIDs.includes(e.target.stationID)?this.selectedStationsIDs.filter((function(t){return t!=e.target.stationID})):[].concat(Object(A["a"])(this.selectedStationsIDs),[e.target.stationID]):this.selectedStationsIDs.includes(e.target.stationID)?[]:[e.target.stationID],console.log(t),this.$store.commit("setselectedStationsByID",t)}},mounted:function(){this.setupLeafletMap()}}),F=z,H=(a("5490"),Object(_["a"])(F,V,T,!1,null,null,null)),B=H.exports,J=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{position:"relative"}},[a("v-row",{staticClass:"py-0 px-0 my-0 mx-0",attrs:{align:"center"}},[a("v-col",{staticClass:"py-0",attrs:{cols:"12"}},[a("v-text-field",{attrs:{"append-icon":"mdi-magnify",label:e.searchPlaceholder,"single-line":"","hide-details":""},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1),a("v-col",{staticClass:"py-0"},[a("v-switch",{attrs:{disabled:!e.hasSelectedItems,label:e.onlySelectedLable},model:{value:e.showOnlySelected,callback:function(t){e.showOnlySelected=t},expression:"showOnlySelected"}})],1),e.hasSelectedItems?a("v-col",{staticClass:"py-0"},[a("v-btn",{attrs:{color:"red",dark:"",small:""},on:{click:e.clearSelection}},[a("v-icon",[e._v("mdi-close")]),e._v(" Apagar seleção ")],1)],1):e._e()],1),a("v-data-table",{attrs:{loading:e.loadingItems,headers:e._headers,items:e._items,search:e.search,"show-select":"","show-expand":void 0!==e.expandableFields,"single-expand":void 0!==e.expandableFields},scopedSlots:e._u([{key:"expanded-item",fn:function(t){var n=t.headers,r=t.item;return[a("td",{attrs:{colspan:n.length}},e._l(e.expandableFields,(function(t,n){return a("v-list-item",{key:n,attrs:{dense:""}},[a("strong",[e._v(e._s(t))]),e._v(": "+e._s(r[t])+" ")])})),1)]}}]),model:{value:e._selectedItems,callback:function(t){e._selectedItems=t},expression:"_selectedItems"}})],1)},Y=[],G={props:{headers:Array,items:Array,selectedItems:Array,loadingItems:Boolean,searchPlaceholder:{type:String,default:"Procurar"},onlySelectedLable:{type:String,default:"Mostrar só selecionados"},expandableFields:Array,selectedHelperText:{type:String,default:"selecionados"}},data:function(){return{search:"",showOnlySelected:!1}},computed:{_selectedHelperText:function(){return"".concat(this.selectedItems.length," ").concat(this.selectedHelperText)},_headers:function(){return[].concat(Object(A["a"])(this.headers),[{text:"",value:"data-table-expand"}])},_selectedItems:{set:function(e){this.$emit("selectItems",e)},get:function(){return this.selectedItems}},_items:function(){return this.showOnlySelected?this.selectedItems:this.items},hasSelectedItems:function(){return this.selectedItems.length>0}},methods:{clearSelection:function(){this.showOnlySelected=!1,this.$emit("clearSelection")}}},U=G,Q=(a("76a5"),a("8336")),X=a("62ad"),Z=a("8fea"),q=a("132d"),K=a("da13"),W=a("0fd9"),ee=a("b73d"),te=Object(_["a"])(U,J,Y,!1,null,null,null),ae=te.exports;I()(te,{VBtn:Q["a"],VCol:X["a"],VDataTable:Z["a"],VIcon:q["a"],VListItem:K["a"],VRow:W["a"],VSwitch:ee["a"],VTextField:M["a"]});var ne={name:"App",components:{Map:B,DatePicker:L,Table:ae},data:function(){return{networks:[],network:null,loadingNetworks:!0,startDate:"1980-01-01",endDate:"2020-12-31",loadingData:!1,showAlert:!1,stationsHeaders:[{text:"Estação",value:"nome"},{text:"Codigo",value:"codigo"},{text:"Latitude",value:"latitude"},{text:"Longitude",value:"longitude"},{text:"Altitude (m)",value:"altitude"}],expandableFields:["id","codigo","nome","altitude","latitude","longitude","coord_x","coord_y","bacia","distrito","concelho","freguesia","entidade_responsavel_automatica","entidade_responsavel_convencional","tipo_estacao_automatica","tipo_estacao_convencional","entrada_funcionamento_automatica","telemetria","estado"],parametersHeaders:[{text:"Parametro",value:"nome"}]}},created:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loadingNetworks=!0,t.next=3,p();case 3:e.networks=t.sent,e.loadingNetworks=!1;case 5:case"end":return t.stop()}}),t)})))()},computed:Object(i["a"])(Object(i["a"])({},Object(c["c"])(["selectedStations","stations","loadingStations","parameters","loadingParameters","selectedParameters"])),Object(c["b"])(["selectedStationsIDs"])),methods:{isDetailParam:function(e){return null!==e&&["diário","horário","diária","horária","hora","dia"].map((function(t){e.nome.includes(t)}))},setSelectedStations:function(e){this.$store.commit("setSelectedStations",void 0===e?[]:e),this.$store.dispatch("getParameters")},setSelectedParameters:function(e){this.$store.commit("setSelectedParameters",void 0===e?[]:e)},getNetworkStations:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$store.dispatch("getStations",e.network.uid);case 2:case"end":return t.stop()}}),t)})))()},getData:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.loadingData=!0,a=[],e.selectedStationsIDs.map(function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(n){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,b(n,e.selectedParameters[0].uid,e.startDate,e.endDate);case 2:r=t.sent,a.push(r);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),console.log("final data",a),e.loadingData=!1;case 5:case"end":return t.stop()}}),t)})))()},setStartDate:function(e){this.startDate=e;var t=new Date(this.startDate),a=new Date(this.endDate);a<t&&(this.endDate=this.formatDate(this.getDateMonthsLater(t)))},setEndDate:function(e){var t=this.validateEndDate(e);t||(this.showAlert=!0)},validateEndDate:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.isDetailParam()){var t=new Date(this.startDate),a=new Date(e||this.endDate),n=this.monthDiff(t,a);if(n>2)return this.endDate=this.formatDate(this.getDateMonthsLater(t)),!1;this.endDate=this.formatDate(a)}return!0},monthDiff:function(e,t){var a;return a=12*(t.getFullYear()-e.getFullYear()),a-=e.getMonth(),a+=t.getMonth(),a<=0?0:a},getDateMonthsLater:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,a=new Date(e.getTime());return a.setMonth(a.getMonth()+t),a},formatDate:function(e){return"".concat(e.getFullYear(),"-").concat(this.zeroPad(e.getMonth()+1),"-").concat(this.zeroPad(e.getDate()))},zeroPad:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return String(e).padStart(t,"0")}}},re=ne,se=a("7496"),ie=a("40dc"),oe=a("c6a6"),ce=a("cc20"),le=a("a523"),de=a("ce7e"),ue=a("f6c4"),me=a("2fa4"),pe=Object(_["a"])(re,r,s,!1,null,null,null),he=pe.exports;I()(pe,{VApp:se["a"],VAppBar:ie["a"],VAutocomplete:oe["a"],VBtn:Q["a"],VChip:ce["a"],VCol:X["a"],VContainer:le["a"],VDivider:de["a"],VIcon:q["a"],VMain:ue["a"],VRow:W["a"],VSpacer:me["a"]});var fe=a("f309");n["a"].use(fe["a"]);var ve=new fe["a"]({});n["a"].use(c["a"]);var ge=new c["a"].Store({state:{stations:[],loadingStations:!1,selectedStations:[],parameters:[],loadingParameters:!1,selectedParameters:[]},getters:{selectedStationsIDs:function(e){return e.selectedStations.map((function(e){return e.uid}))}},mutations:{setStations:function(e,t){e.stations=t},setLoadingStations:function(e,t){e.loadingStations=t},setSelectedStations:function(e,t){e.selectedStations=t},setselectedStationsByID:function(e,t){e.selectedStations=e.stations.filter((function(e){return t.includes(e.uid)}))},setParameters:function(e,t){e.parameters=t},setLoadingParameters:function(e,t){e.loadingParameters=t},setSelectedParameters:function(e,t){e.selectedParameters=t}},actions:{getStations:function(e,t){return Object(o["a"])(regeneratorRuntime.mark((function a(){var n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return e.commit("setStations",[]),e.commit("setSelectedStations",[]),e.commit("setLoadingStations",!0),a.next=5,f(t);case 5:n=a.sent,e.commit("setStations",n),e.commit("setLoadingStations",!1);case 8:case"end":return a.stop()}}),a)})))()},getParameters:function(e){return Object(o["a"])(regeneratorRuntime.mark((function t(){var a,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.commit("setLoadingParameters",!0),a=e.getters.selectedStationsIDs,!(a.length>0)){t.next=8;break}return t.next=5,g(e.getters.selectedStationsIDs);case 5:n=t.sent,t.next=9;break;case 8:n=[];case 9:e.commit("setParameters",n),e.commit("setLoadingParameters",!1);case 11:case"end":return t.stop()}}),t)})))()}}});n["a"].config.productionTip=!1,new n["a"]({vuetify:ve,store:ge,render:function(e){return e(he)}}).$mount("#app")},"694f":function(e,t,a){},"76a5":function(e,t,a){"use strict";a("694f")},a6b6:function(e,t,a){}});
//# sourceMappingURL=app.e10187a9.js.map